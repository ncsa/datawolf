#!/bin/sh

# port for the jetty server
PORT=8080

# change to folder of cyberintegrator
cd $(dirname $0)/..

# create some folders just in case
if [ ! -e log ]; then
  mkdir log
fi
if [ ! -e data/db ]; then
  mkdir -p data/db
fi
if [ ! -e data/files ]; then
  mkdir -p data/files
fi

# setup for the server
WAR=$( ls -1 lib/cyberintegrator-webapp-all*.war | tail -1 )
cat > conf/jetty.xml << EOF
<Configure class="org.eclipse.jetty.webapp.WebAppContext">
  <Set name="contextPath">/</Set>
  <Set name="war">${PWD}/${WAR}</Set>
  <Call name="setInitParameter">
    <Arg>contextConfigLocation</Arg>
    <Arg>file://${PWD}/conf/applicationContext.xml</Arg>
  </Call>
</Configure>
EOF
fi

# start actual webapp
java -Xmx512m -Dlog4j.configuration=file:///${PWD}/conf/log4j.properties -jar ${PWD}/lib/jetty-runner.jar --port ${PORT} ${PWD}/conf/jetty.xml
